<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Kudo Wall - Board</title>

    
    <link rel="stylesheet" href="commons/commons.css">
    <link rel="stylesheet" href="commons/board.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <script src="commons/tenant.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <script src="commons/hotjar.js"></script>
</head>
<body style="background-image: unset; background-color: white;">
    <div id="app">
        <nav class="header">
            <h1>Kudo Wall</h1>
            <h4>Semana {{weekOfYear}}/{{year}} ({{startWeek}} até {{endWeek}})</h4>
        </nav>
        <div class="actions">
            <div class="selo-verde">
                <i></i>
                <label>{{sustainable.papers}} folhas A4 preservadas</label>
            </div>
            <div></div>
            <a class="button" href="/cadastrar.html" title="Libera ai seu Kudo, vai.">+ Enviar</a>
        </div>
        <div class="content-center" v-if="cards.length === 0">
            <img src="commons/travolta-kudo.gif">
        </div>
        <div class="cards" v-if="cards.length > 0">
            <div v-for="card in cards" v-key="card.id" class="card">
                <div :class="'title ' + getColor(card.meme)">
                    {{card.title}}
                </div>
                <div class="content">
                    <img :src="`private/${team}/memes/${card.meme}`" class="meme">
                    <div class="member">
                        <b>{{card.member}},</b>
                    </div>
                    <div class="message">
                        {{card.description}}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const app = new Vue({
            el: '#app',
            data: {
                cards:[],
                memes: [],
                sustainable: { papers: 0, cards: 0 }
            },
            methods: {
                loadBoard() {
                    fetch(`${uri}/board/${team}/${year}-${weekOfYear}`)
                    .then(response => response.json())
                    .then(myJson => this.$data.cards = myJson.sort((a, b) => moment(b.timestamp).diff(moment(a.timestamp))));
                },
                loadSustainable() {
                    fetch(`${uri}/sustainable`)
                    .then(response => response.json())
                    .then(json => this.$data.sustainable = json)
                },
                loadMemes() {
                    fetch(`private/${team}/memes.json`)
                    .then(response => {
                        if (response.status !== 200) {
                            alert('Time não configurado, verifique com seu time ou fale com seu gestor.');
                            return [];
                        }
                        return response.json();
                    })
                    .then(myJson => this.$data.memes = myJson);            
                },
                getColor(meme) {
                    console.log(this.$data.memes.filter(e => e.image === meme)[0].color);
                    return this.$data.memes.filter(e => e.image === meme)[0].color;
                }
            },
            created() {
                this.loadMemes();
                this.loadBoard();
                this.loadSustainable();
            }
        });
    </script>
</body>
</html>

